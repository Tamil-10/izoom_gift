function closePopUpList(){$(".s-button").removeClass("opened"),$(".s-w-arrow").removeClass("is-active"),$(".s-item-wrapper").removeClass("active"),$("body").removeClass("no-scroll"),$("#s-bar-overlay").removeClass("is-active"),popUpOpen=!1}function closeFilterMenu(){$(".facet-option").removeClass("is-active"),$(".clk-filter").removeClass("open-filter"),$(".filter-menu").removeClass("is-active"),$(".filter-overlay").removeClass("is-active"),$(".price-filter-block").removeClass("is-active"),$(".price-filter-block").animate({right:0}),$("body").removeClass("has-active-menu")}function showSelectionTooltip(e){$(".selection-text").text(e.data("tooltip"));var t=$(".selection-bar-tooltip"),i=e.offset().top+e.outerHeight()+6,a=e.offset().left+e.outerWidth()/2-t.outerWidth()/2;t.css({top:i+"px",left:a+"px"}),window.setTimeout(function(){t.show()},100)}$("select.spanel").each(function(){var e=$(this),t=$(this).children("option").length;e.addClass("s-hidden"),e.addClass("hidden"),e.wrap('<div class="select"></div>'),e.after('<div class="styledSelect"></div>');var i=e.next("div.styledSelect");e.children("option:selected").length?i.text(e.children("option:selected").text()):i.text(e.children("option").eq(0).text());for(var a=$("<ul />",{"class":"options"}).insertAfter(i),s=0;t>s;s++)$("<li />",{text:e.children("option").eq(s).text(),rel:e.children("option").eq(s).val()}).appendTo(a);a.children("li");i.click(function(e){e.stopPropagation(),$(this).hasClass("active")?($(".styledSelect").removeClass("active"),$("ul.options").hide()):($(".styledSelect").removeClass("active"),$("ul.options").hide(),$(this).addClass("active").next("ul.options").show())}),$(document).click(function(){i.removeClass("active"),a.hide()})}),$(document).on("click","ul.options li",function(e){e.stopPropagation();var t=$(this).parent().prev(".styledSelect"),i=$(this).parent(),a=$(this).parent().siblings("select.spanel");t.text($(this).text()).removeClass("active"),a.val($(this).attr("rel")),a.trigger("change"),i.hide()}),function(){var e=$(".filter-footer").height();$(".filter-show").css("height","calc(100% - "+e+"px)"),$(window).on("resize",function(){if($(".filter-menu").is(":visible")){var e=$(".filter-footer").height();$(".filter-show").css("height","calc(100% - "+e+"px)")}else{var e=$(".filter-footer").height();$(".filter-show").css("height","calc(100% - "+e+"px)")}})}();var popUpOpen=!1;$("#site-wrapper").on("click",".s-button",function(){var e=$(this).data("selected-type");$("#"+e+"-items").hasClass("active")?closePopUpList():($("body").addClass("no-scroll"),$(".s-item-wrapper").removeClass("active"),$(".s-w-arrow").removeClass("is-active"),$(".s-button").removeClass("opened"),$(this).addClass("opened"),$("#"+e+"-items").addClass("active"),$("#s-bar-overlay").addClass("is-active"),$(this).find(".s-w-arrow").addClass("is-active"),popUpOpen=!0)}),$(document).on("click",function(e){$(e.target).closest(".refine-list").length||popUpOpen&&closePopUpList(),$(e.target).closest(".filter-menu, .filter-text, .selected-property").length||closeFilterMenu(),$(e.target).closest(".spl-del-label").length||($(".spl-del-popup").removeClass("is-active"),$("#d-mask").removeClass("is-active"),delTypeOpen=!1)}),$("#site-wrapper").on("click",".s-item-list li, .s-item-close, .s-bar-overlay",function(){closePopUpList()}),document.addEventListener("keydown",function(e){var t=e.keyCode||e.which;27===t&&($(".s-bar-overlay").is(":visible")&&closePopUpList(),$(".filter-overlay").is(":visible")&&closeFilterMenu(),$(".mega-menu-wrapper").hasClass("active")&&window.history.go(-1))});var mmOpen=!1;$(document).on("click",".m-title-text",function(){$(".mega-menu-wrapper").hasClass("active")?window.history.go(-1):window.location.hash="#cat-mm"}),$(document).on("click",".close-mm",function(){window.history.go(-1)}),$(document).on("change",".mm-radio",function(){var e=$(this).data("target");$(".mm-link").each(function(){var t=$(this).data("url-"+e);$(this).data(e)?($(this).removeClass("mm-disabled"),$(this).attr("href",t)):$(this).addClass("mm-disabled")})}),$(".sel-tooltip").hover(function(){showSelectionTooltip($(this))},function(){$(".selection-bar-tooltip").hide()});;
function chkCountryCityTitle(){var e=$("#country").val(),t=e?$("#country").val().trim():e,i=$("#city").val(),a=i?$("#city").val().trim():i;e&&""!==t||i&&""!==a?e&&""!==t?$(".countryTitle").text("to "+$("#country").val().trim()):i&&""!==a&&$(".countryTitle").text("to "+$("#city").val().trim()):$(".countryTitle").text("")}function loadProds(e,t,i){var a=getCookie("getQ"),s={};a&&(s=JSON.parse(decodeURIComponent(a)));var o=getCookie("mpl");o&&""!==o&&(s.mpl=o),s.sort=$(".sort ul.c-dd-options li.selected").data("value");var n=0;s&&(""!=s.delivery_types&&void 0!=s.delivery_types&&null!=s.delivery_types||delete s.delivery_types,void 0!=s.pincode&&null!=s.pincode&&""!=s.pincode||delete s.pincode),$.ajax({url:"/api/products",method:"POST",dataType:"json",data:JSON.stringify({post:e,get:s}),contentType:"application/json; charset=UTF-8",async:!0,cache:!0,beforeSend:function(e){n=t-i>32?32:t-i;for(var a="",s=0;n>s;s++)a+='<li class="product-grid-item col s3 products-loader"><div class="product-item z-depth-1 hoverable"><div class="animated-background" style="min-height: 278px;"></div><div class="product-info" style="padding-top: 10px;"><div class=" row no-margin animated-background" style="max-height: 10px; width:50%;"><div class="col s12 no-padding"><p class="product-name"></p></div></div><div class="row no-margin animated-background" style="margin-top: 10px; max-height: 10px; width: 20%;"><div class="col s8 no-padding"><p class="product-price"><span class="number"></span> </p></div><div class="col s4 no-padding"><p class="offer-p"></p></div></div></div></div></li>';$("#product-grid").append(a);var o=0;$(".products-loader").each(function(){var e=$(this);e.css({display:"block",opacity:0}),e.delay(o).animate({"margin-top":"0px",opacity:1}),o+=100})},success:function(e,a,s){if(e.status&&"Success"===e.status){$(".show-more-clk").data("loaded-prods",i+n).attr("data-loaded-prods",i+n);var o=e.data.products,r=generateProductHTML(o);$(".products-loader").remove(),$("#product-grid").append(r),$("#product-grid .product-grid-item img.img-responsive.lazy-product-image").lazyload({effect:"fadeIn",failure_limit:25}),paginated_prods+=r,sessionStorage.setItem("paginated_prods",paginated_prods),sessionStorage.setItem("paginated_prods_URL",window.location.href),sessionStorage.setItem("paginated_prods_Currency",getCookie("currency"))}if(t!=i+n){var l=i+n,c="Show More products (<span class='number'>"+(t-l)+"</span>)";$(".show-more-clk").html(c).show(),sessionStorage.setItem("paginated_prods_showmore",$(".show-more-clk").parent().html())}else sessionStorage.removeItem("paginated_prods_showmore")},error:function(e,t){$(".show-more-clk").show()},complete:function(e,t){$(".products-loader").hide()}})}function spdChangeHandler(){var e="";$(".spl-d-t:checked").each(function(){e+=","+$(this).attr("id")}),e=e.substring(1),sdtModified=e!==sdtObj.delivery_types}function makePinInlineEditable(){$("#pin-item .pincode-text").addClass("hidden"),$("#tag-form").removeClass("hidden"),$("#inline-pincode").val(sdtObj.pincode).focus().select()}function makePinInlineUnEditable(){$("#pin-item .pincode-text").removeClass("hidden"),$("#tag-form").addClass("hidden")}function getAllPriceRanges(){var e="",t=$(".prange").length;return $(".prange").each(function(i,a){e+=$(this).data("value"),t-1>i&&(e+=",")}),e}function getSelectedPriceRanges(){var e="",t=$(".prange:checked").length;return $(".prange:checked").each(function(i,a){e+=$(this).data("value"),t-1>i&&(e+=",")}),e}function updatePriceFiltersCount(e){$(".prange").attr("disabled",!0);for(var t in e){var i=e[t].d;i=i.substring(4);var a=$('.prange[data-value="'+i+'"]');$('.prange[data-value="'+i+'"] + label.p-range span.price-count').text(" ("+e[t].n+")"),0==e[t].n?a.attr({disabled:!0,checked:!1}):a.attr({disabled:!1})}}function updateAttributeSetCount(e,t){var i=t.data("key"),a="";$(".facet-prop").each(function(s,o){var n=$(this).attr("id");a=$(o).data("key"),a==i?t.prop("checked")?console.log("don't update"):$(this).find(".prop_check:not(:checked)").length==$(this).find(".prop_check").length?(console.log("1 update filter group"+a),updateUsingResponse(e,n),updatePriceFiltersOnUnselect()):(console.log("1 update filter group after calling api"+a),updateUsingApiCall(a,function(e){updateUsingResponse(e,n)})):$(this).find(".prop_check:not(:checked)").length==$(this).find(".prop_check").length||$(this).find(".prop_check:checked").length==$(this).find(".prop_check").length?(console.log("2 update filter group"+a),updateUsingResponse(e,n)):(console.log("2 update filter group after calling api"+a),updateUsingApiCall(a,function(e){updateUsingResponse(e,n)}))})}function updatePriceFiltersOnUnselect(e){var t=getCookie("query"),i=JSON.parse(decodeURIComponent(t));i.l=1;var a=buildGetQForFacet();a.facets="all,is_hamper,is_personalizable,color",a.mrp=getAllPriceRanges(),delete a.prange,$.ajax({url:"/api/facets",method:"POST",dataType:"json",data:JSON.stringify({post:i,get:a}),contentType:"application/json; charset=UTF-8",async:!0,cache:!0,beforeSend:function(e){},success:function(e,t,i){if(e.status&&"Success"===e.status){num=e.data.num;var a=e.data.facets;for(var s in a)for(var o in a[s])"mrp"==o&&updatePriceFiltersCount(a[s][o])}},complete:function(e,t){}})}function updateUsingResponse(e,t){console.log("element"+t);var i=e,a={};for(var s in i)for(var o in i[s])"mrp"==o&&(updatePriceFiltersCount(i[s][o]),i.splice(s,1));for(var s in i){var n=i[s];for(var r in n){var l=n[r];for(var c in l)a[l[c].d]=l[c].n}}$("#"+t).find(".prop_check").each(function(){var e=$(this).data("value");a.hasOwnProperty(e)?($(this).attr("disabled",!1),$(this).parent().find("span").html(a[e]),console.log(e+" --- "+a[e])):(console.log(e+" ++++ "+a[e]),$(this).parent().find("span").html("0"),$(this).attr("disabled",!0),$(this).prop("checked",!1))})}function updateUsingApiCall(e,t){var i=getCookie("query"),a=JSON.parse(decodeURIComponent(i));a.l=1;var s=buildGetQForFacet();s.facets="all,is_hamper,is_personalizable,color",delete s[e],$.ajax({url:"/api/facets",method:"POST",dataType:"json",data:JSON.stringify({post:a,get:s}),contentType:"application/json; charset=UTF-8",async:!0,cache:!0,beforeSend:function(e){},success:function(e,i,a){e.status&&"Success"===e.status&&(num=e.data.num,t(e.data.facets))}})}function reLoadProducts(e,t,i,a){var s=getCookie("query"),o=JSON.parse(decodeURIComponent(s)),n=getCookie("getQ"),r=JSON.parse(decodeURIComponent(n)),r=removeOldSelectedFacets(r);r.facets=getFacetQuery(),$(".s-button.selectable").each(function(){if($(this).data("val"))switch($(this).data("selected-type")){case"recipient":r.rc=$(this).attr("data-val").split("|")[0];break;case"relationship":r.rl=$(this).attr("data-val").split("|")[0];break;case"occasion":console.log($(this).attr("data-val")),r.o=$(this).attr("data-val").split("|")[0];break;case"personality":console.log($(this).attr("data-val")),r.p=$(this).attr("data-val").split("|")[0]}}),""!==$(".cat-sel-show").text()&&void 0===o.c&&(r.category='"'+$(".cat-sel-show").text()+'"'),""!==$(".subCat-sel-show").text()&&void 0===o.sc&&(r.subcategory='"'+$(".subCat-sel-show").text()+'"'),""!==$(".prod-filter-click.selected-gb").text()&&void 0===o.pt&&(r.product_type='"'+$(".prod-filter-click.selected-gb").text()+'"'),$(".p-filter-tags.selected-item").length>0&&(r[$(".p-filter-tags.selected-item").data("key")]=$(".p-filter-tags.selected-item").data("value"));var l={};$(".prop_check:checked").each(function(){l.hasOwnProperty($(this).data("key"))?l[$(this).data("key")].push('"'+$(this).data("value")+'"'):(l[$(this).data("key")]=[],l[$(this).data("key")].push('"'+$(this).data("value")+'"'))}),$(".prange:checked").each(function(){l.hasOwnProperty("prange")?l.prange.push($(this).data("value")):(l.prange=[],l.prange.push($(this).data("value")))}),$(".color-prop.selected").each(function(){l.hasOwnProperty($(this).data("key"))?l[$(this).data("key")].push($(this).data("value")):(l[$(this).data("key")]=[],l[$(this).data("key")].push($(this).data("value")))});for(var c in l)r[c]=l[c].join(",");for(c in sdtObj)r[c]=sdtObj[c];delete r.is_hamper,delete r.is_personalizable,$(".checkbox-hp:checked").each(function(){r[$(this).data("key")]=$(this).data("value")}),"pincode"in sdtObj||delete r.pincode,"country"in sdtObj||delete r.country,"city"in sdtObj||delete r.city;var d="";$(".spl-d-t:checked").each(function(){d+=","+$(this).attr("id")}),d=d.substring(1),r.delivery_types=d,r.sort=$(".sort ul.c-dd-options li.selected").data("value")?$(".sort ul.c-dd-options li.selected").data("value"):"wt_desc",setCookie("getQ",JSON.stringify(r));var p=getCookie("mpl");p&&""!==p&&(r.mpl=p);var u=0;r&&(""!=r.delivery_types&&void 0!=r.delivery_types&&null!=r.delivery_types||delete r.delivery_types,void 0!=r.pincode&&null!=r.pincode&&""!=r.pincode||delete r.pincode);var h=JSON.parse(JSON.stringify(r));if("wt_desc"===h.sort&&delete h.sort,e?(delete h.category,delete h.subcategory,delete h.product_type,delete h.facets,delete h.price,delete h.mpl,delete h.sort,delete h.prange):delete h.facets,0!==Object.keys(h).length){var m={getQ:JSON.stringify(h)};if(!a){var f=window.location.search;f=f.replace("?","").split("&");for(var v in f)f[v]&&"getQ"!==f[v].split("=")[0]&&-1!==allowedQueryParmas.indexOf(f[v].split("=")[0])&&(m[f[v].split("=")[0]]=f[v].split("=")[1])}var g=[];for(var v in m)g.push(encodeURIComponent(v)+"="+encodeURIComponent(m[v]));history.pushState({},null,"?"+g.join("&"))}else history.pushState({},null,window.location.pathname);return e?(sessionStorage.removeItem("paginated_prods"),sessionStorage.removeItem("paginated_prods_showmore"),void location.reload()):(r&&r.occasion_12_fa&&(r.occasion_12_fa='"'+r.occasion_12_fa+'"'),void $.ajax({url:"/api/products",method:"POST",dataType:"json",data:JSON.stringify({post:o,get:r}),contentType:"application/json; charset=UTF-8",async:!0,cache:!0,beforeSend:function(e){u=num>16?16:num;for(var t="",i=0;u>i;i++)t+='<li class="product-grid-item col s3 products-loader"><div class="product-item z-depth-1 hoverable"><div class="animated-background" style="min-height: 278px;"></div><div class="product-info" style="padding-top: 10px;"><div class=" row no-margin animated-background" style="max-height: 10px; width:50%;"><div class="col s12 no-padding"><p class="product-name"></p></div></div><div class="row no-margin animated-background" style="margin-top: 10px; max-height: 10px; width: 20%;"><div class="col s8 no-padding"><p class="product-price"><span class="number"></span> </p></div><div class="col s4 no-padding"><p class="offer-p"></p></div></div></div></div></li>';$("#product-grid").html(t);var a=0;$(".products-loader").each(function(){var e=$(this);e.css({display:"block",opacity:0}),e.delay(a).animate({"margin-top":"0px",opacity:1}),a+=100}),$(".show-more-clk").hide(),chkCountryCityTitle()},success:function(a,s,o){if(a.status&&"Success"===a.status&&a.data.num>0){num=a.data.num,$(".prod-num-chk").show(),$(".show-more-clk").data("total-prods",a.data.num),$(".t-p-c").html(a.data.num+" Products"),$(".show-more-clk").data("loaded-prods",a.data.products.length);var n=a.data.products,r=generateProductHTML(n);$(".products-loader").remove(),$("#product-grid").html(r),sessionStorage.removeItem("paginated_prods"),sessionStorage.removeItem("paginated_prods_showmore"),$("#product-grid .product-grid-item img.img-responsive").lazyload({effect:"fadeIn",failure_limit:25});var l=!1,c=!1;for(var d in a.data.hp.is_hamper)l=!a.data.hp.is_hamper[d].d||0!=a.data.hp.is_hamper[d].n;for(var d in a.data.hp.is_personalizable)c=!a.data.hp.is_personalizable[d].d||0!=a.data.hp.is_personalizable[d].n;if($("#h-check")&&(l?$("#h-check").removeAttr("disabled"):$("#h-check").attr("disabled","true")),$("#p-check")&&(c?$("#p-check").removeAttr("disabled"):$("#p-check").attr("disabled","true")),n.length<a.data.num){var p=n.length,u=a.data.num,h="Show More products (<span class='number'>"+(u-p)+"</span>)";$(".show-more-clk").html(h).show()}if($(".no_product").hasClass("hidden")||$(".no_product").addClass("hidden"),!$(".cat-sel-show").text()||$(".subCat-sel-show").text()||$(".prod-filter-click.selected-gb").text())if($(".cat-sel-show").text()&&$(".subCat-sel-show").text()&&!$(".prod-filter-click.selected-gb").text()){var h="REFINE : <span>"+$(".subCat-sel-show").text()+"</span>";$(".filter-text").addClass("filter-enabled")}else if($(".cat-sel-show").text()&&$(".subCat-sel-show").text()&&$(".prod-filter-click.selected-gb").text()){var h="REFINE : <span>"+$(".prod-filter-click.selected-gb").text()+"</span>";$(".filter-text").addClass("filter-enabled")}else $(".filter-text").addClass("filter-enabled");else{var h="REFINE : <span>"+$(".cat-sel-show").text()+"</span>";$(".filter-text").addClass("filter-enabled")}($(".cat-sel-show").text()||$(".subCat-sel-show").text()||$(".prod-filter-click.selected-gb").text())&&$(".cat-f-list-item").each(function(){$(this).find("span:last-of-type").text()==$(".cat-sel-show").text()&&$(this).addClass("selected-item")}),t&&updateFacetOptions(a,e),$("#topProducts").hide()}else $(".prod-num-chk").hide(),$("#product-grid").html(""),$(".t-p-c").html("0 Products"),$(".no_product").removeClass("hidden"),t&&updateFacetOptions(a,e);i()},complete:function(e,t){}}))}function generateProductHTML(e){var t="";return e.forEach(function(e){if(t+='<div class="product-grid-item col s3" data-pid="'+e.id+'" data-url="/'+e.url+'">',t+='<div class="product-item z-depth-1 hoverable">',t+='<div class="image-holder">',t+='<a href="/'+e.url+'" ><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-original="'+cdn.productsURL+cdn.productsURLTransformationM+cdn.productsURLFolder1+e.image+'" class="img-responsive product-image lazy lazy-product-image " alt="'+e.dname+'" title="'+e.dname+'" data-url="/'+e.url+'">',t+='<div class="row no-margin ">',t+='<div class="col s12 no-padding">',t+='<div class="product-name-w">',t+='<p class="product-name">'+e.dname+"</p>",t+="</div></div></div>",t+="</a>",t+=e.pers?e.eggless?"":'<div class="pdp-label bottom-left">Personalizable</div>':"",t+=e.eggless?'<div class="pdp-label bottom-left">Eggless also</div>':"",t+=e.interflora&&5==$("body").data("stid")?'<div class="if-img-label"><img src="/images/if.png" class="img-responsive" alt="Interflora India" title="Interflora India"/></div>':"",e.flag_express){t+='<div class="exp-date-label">',t+='<div class="edl-text"><div class="relative">Delivery By</div></div>',t+='<div class="edl-date">',t+='<div class="relative">';var i=getExpressDate(e.flag_express);t+='<span class="edl-number">'+i.date+'</span><br/><span class="edl-month bold">'+i.month+"</span>",t+="</div></div></div>"}if(e.dt.hasOwnProperty("Fixeddate")&&5==$("body").data("stid")&&(t+=hoursPassed>=sameDayLimit||e.delivery_days>0?'<div class="pdp-label top-right">Next Day Delivery</div>':'<div class="pdp-label top-right">Same Day Delivery</div>'),5!=$("body").data("stid")||corpLabel||(t+='<div class="sl-star-wrapper"><div class="sl-star" data-pid="'+e.id+'" data-in-slist="0">',t+='<div class="icon-wrapper sl-icon-star"><svg viewBox="0 0 2 2" class="s-icon">',t+='<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/svgs/main.svg#shape-shortlist"></use>',t+="</svg></div></div></div>",t+="</div>"),t+='<div class="product-info">',0===e.price.dprice_inr?(t+='<div class="row no-margin">',t+='<div class="col s8 no-padding">',t+='<p class="product-price"><span class="number">'+getPriceInfo(e.price,"normal",currency)+"</span> </p>",t+="</div>",t+='<div class="col s4 no-padding"><p class="offer-p"></p></div>',t+="</div>"):(t+='<div class="row no-margin">',t+='<div class="col s8 no-padding">',t+='<p class="product-price"><span class="number offer">'+getPriceInfo(e.price,"disc",currency)+'</span> <span class="number">'+getPriceInfo(e.price,"normal",currency)+"</span> </p>",t+="</div>",t+='<div class="col s4 no-padding">',t+='<p class="offer-p"><span class="offer-label number">'+e.discount+" OFF</span></p>",t+="</div></div>"),t+="</div>",t+='<div class="row variant-container no-margin">',e.dt.hasOwnProperty("Fixeddate"))hoursPassed>=sameDayLimit||e.delivery_days>0?(t+='<div class="col s12 no-padding">',t+='<p class="shipping-text">Can be delivered tomorrow.</p>',t+="</div>"):(t+='<div class="col s12 no-padding">',t+='<p class="shipping-text">Get it today! Order before 4pm IST</p>',t+="</div>");else{if(t+='<div class="col s12 no-padding">',e.flag_express){var i=getExpressDate(e.flag_express);t+='<p class="shipping-text">Guaranteed delivery by '+i.date+" "+i.month+".</p>"}else t+=e.flag_fs?'<p class="shipping-text">Free Shipping</p>':0==e.delivery_days?'<p class="shipping-text">Product will be dispatched today.</p>':1==e.delivery_days?'<p class="shipping-text">Product will be dispatched by tomorrow.</p>':e.delivery_days<0?'<p class="shipping-text">Product will be dispatched in 2-3 days.</p>':'<p class="shipping-text">Product will be dispatched in '+(e.delivery_days-1)+"-"+e.delivery_days+" days.</p>";t+="</div>"}t+="</div></div></div></div>"}),t}function generateFilterGroupHtml(e){if(!e)return"";var t=e.length,i=(Math.ceil(t/2),'<div class="filter-col">');for(var a in e){var s=e[a];i+='<div class="filter-div">',i+='<div class="prop-name">';for(var o in s){var n=o.split("_");n.splice(-2,2);var r=n.join("_");console.log(r),i+='<span class="filter-label-case">'+r+"</span></div>";var l=s[o];i+='<ul class="facet-prop" data-key="'+o+'" id="'+o+'-ul">';for(var c in l)i+='<li><input type="checkbox" class=" filled-in prop_check" id="'+o+"-"+c+'" data-key="'+o+'" data-value="'+l[c].d+'"/><label class="filter-label" for="'+o+"-"+c+'">\n'+l[c].d+" (<span>"+l[c].n+"</span>)\n</label></li>";i+="</ul>"}i+="</div>",a%2!==0&&parseInt(a)!==t-1&&(i+='</div><div class="filter-col">')}return i+="</div>"}function getFacetQuery(){var e="";return""===$(".cat-sel-show").text()?e="category,is_hamper,is_personalizable,color":""!==$(".cat-sel-show").text()&&""===$(".subCat-sel-show").text()?e="subcategory,is_hamper,is_personalizable,color":""!==$(".cat-sel-show").text()&&""!==$(".subCat-sel-show").text()&&""===$(".prod-filter-click.selected-gb").text()?e="product_type,is_hamper,is_personalizable,color":""!==$(".cat-sel-show").text()&&""!==$(".subCat-sel-show").text()&&""!==$(".prod-filter-click.selected-gb").text()?e="all,is_hamper,is_personalizable,color":void 0}function updateFacetOptions(e,t){if(update_hp(e),""===$(".cat-sel-show").text()){var i={};e.data.facets[0]&&e.data.facets[0].category.forEach(function(e,t){i[e.d]=e.n}),$(".cat-show-filter.cat-filter-click").each(function(e,t){i[$(t).text()]?$(t).addClass("clk"):$(t).removeClass("clk")})}if(""!==$(".cat-sel-show").text()&&""===$(".subCat-sel-show").text()){var a={};e.data.facets[0]&&e.data.facets[0].subcategory.forEach(function(e,t){a[e.d]=e.n}),$(".cat-show-filter.subCat-filter-click").each(function(e,t){a[$(t).text()]?$(t).addClass("clk"):$(t).removeClass("clk")})}if(""!==$(".cat-sel-show").text()&&""!==$(".subCat-sel-show").text()&&""===$(".prod-filter-click.selected-gb").text()){var s={};e.data.facets[0]&&e.data.facets[0].product_type.forEach(function(e,t){s[e.d]=e.n}),$(".cat-show-filter.prod-filter-click").each(function(e,t){s[$(t).text()]?$(t).addClass("clk"):$(t).removeClass("clk")})}if(""!==$(".cat-sel-show").text()&&""!==$(".subCat-sel-show").text()&&""!==$(".prod-filter-click.selected-gb").text()){var o=e.data.facets,n={};for(var r in o){var l=o[r];for(var c in l){var d=l[c];for(var p in d)n[d[p].d]=d[p].n}}console.log(n),$(".filter-div .prop_check").each(function(){var e=$(this).data("value");n.hasOwnProperty(e)&&n[e]>0?($(this).attr("disabled",!1),$(this).parent().find("span").html(n[e])):($(this).attr("disabled",!0),$(this).attr("checked",!1),$(this).parent().find("span").html("0"))})}updateColorFilter(e.data.colors),filter_menu_html=$(".filter-menu").html()}function update_hp(e){var t=0,i=0;e.data.hp.is_hamper&&e.data.hp.is_hamper.forEach(function(e,i){"true"===e.d&&($(".checkbox-hp.hamper").data("count",e.n),t=e.n)}),e.data.hp.is_personalizable&&e.data.hp.is_personalizable.forEach(function(e,t){"true"===e.d&&($(".checkbox-hp.personalizable").data("count",e.n),i=e.n)}),0===t?$(".checkbox-hp.hamper").attr("disabled",!0):$(".checkbox-hp.hamper").attr("disabled",!1),0===i?$(".checkbox-hp.personalizable").attr("disabled",!0):$(".checkbox-hp.personalizable").attr("disabled",!1)}function buildGetQForFacet(e){var t=getCookie("query"),i=JSON.parse(decodeURIComponent(t)),a={},s=getCookie("mpl");s&&""!==s&&(a.mpl=s),$(".notred select.changeable").each(function(){if(""!==$(this).val())switch($(this).data("type")){case"recipient":a.rc='"'+$(this).val().split("|")[0]+'"';break;case"relationship":a.rl='"'+$(this).val().split("|")[0]+'"';break;case"occasion":a.o='"'+$(this).val().split("|")[0]+'"';break;case"personality":a.p='"'+$(this).val().split("|")[0]+'"'}}),$(".checkbox-hp:checked").each(function(){a[$(this).data("key")]=$(this).data("value")});var o={};$(".prange:checked").each(function(){o.hasOwnProperty("prange")?o.prange.push($(this).data("value")):(o.prange=[],o.prange.push($(this).data("value")))}),$(".color-prop.selected").each(function(){o.hasOwnProperty($(this).data("key"))?o[$(this).data("key")].push($(this).data("value")):(o[$(this).data("key")]=[],o[$(this).data("key")].push($(this).data("value")))}),""!==$(".cat-sel-show").text()&&void 0===i.c&&(a.category='"'+$(".cat-sel-show").text()+'"'),""!==$(".subCat-sel-show").text()&&void 0===i.sc&&(a.subcategory='"'+$(".subCat-sel-show").text()+'"'),""!==$(".prod-filter-click.selected-gb").text()&&void 0===i.pt&&(a.product_type='"'+$(".prod-filter-click.selected-gb").text()+'"'),e||$(".prop_check:checked").each(function(){o.hasOwnProperty($(this).data("key"))?o[$(this).data("key")].push('"'+$(this).data("value")+'"'):(o[$(this).data("key")]=[],o[$(this).data("key")].push('"'+$(this).data("value")+'"'))});var n=[];$(".mpl-price.selected").each(function(e,t){n.push($(this).data("value"))}),n.length&&(a.mpl=n.join()),setCookie("mpl",n.join());for(var r in o)a[r]=o[r].join(",");for(r in sdtObj)a[r]=sdtObj[r];return a}function updateColorFilter(e){var t={};for(var i in e)e[i].forEach(function(e,i){t[e.d]=e});$(".colors .color-prop").each(function(){t[$(this).data("value")]?$(this).removeClass("disabled"):$(this).addClass("disabled")})}function removeOldSelectedFacets(e){var t=/_fa$/;for(var i in e)t.test(i)&&delete e[i];return e}var num=$(".show-more-clk").data("total-prods"),sdtObj={},sdtModified=!1,sdtApplied=!1,attrSetOrder=[],filter_menu_html="",paginated_prods=sessionStorage.getItem("paginated_prods")?sessionStorage.getItem("paginated_prods"):"",allowedQueryParmas=["city","country","pincode"],countriesHash={},countriesHashCode={},countriesArr=[];window.onpopstate=function(e){if(e.state){console.log("Popstate changed !!!!!");var t=JSON.parse(getLocalStorageValue("searchhistoryurl")),i=-1!==ignoreHash.indexOf(window.location.hash)||1===t.length&&-1!==ignoreHash.indexOf(t[0])||t.length>1&&-1!==ignoreHash.indexOf(t[1]);if(i)return;location.reload()}},$(document).ready(function(){$("#pincode").val()&&""!==$("#pincode").val()&&6===$("#pincode").val().length?sdtObj.pincode=$("#pincode").val():$("#pincode").val(""),$("#city").val()&&""!==$("#city").val()&&(sdtObj.city=$("#city").val()),$("#country").val()&&""!==$("#country").val()&&(sdtObj.country=$("#country").val()),sdtObj.delivery_types="",$(".spl-d-t:checked").each(function(){sdtObj.delivery_types+=","+$(this).attr("id")}),sdtObj.delivery_types&&""!==sdtObj.delivery_types?sdtObj.delivery_types=sdtObj.delivery_types.substring(1):delete sdtObj.delivery_types}),$(document).on("click",".show-more-clk",function(){$(this).hide();var e=$(this).data("total-prods");console.log("totProds "+e);var t=$(this).data("loaded-prods");if(console.log("loadProds "+t),e>t){var i=getCookie("query"),a=JSON.parse(i?decodeURIComponent(i):"{}");a.off=t,a.l=32,loadProds(a,e,t)}}),$(document).ready(function(){var e=(getCookie("getQ"),sessionStorage.getItem("paginated_prods")),t=sessionStorage.getItem("paginated_prods_URL"),i=sessionStorage.getItem("paginated_prods_showmore"),a=sessionStorage.getItem("paginated_prods_Currency"),s=window.location.href;if(e&&t===s&&a==getCookie("currency")){$("#product-grid").append(e),i?$(".show-more-clk").parent().html(i):$(".show-more-clk").hide();var o=sessionStorage.getItem("visted_pid");o&&0!==$(".product-grid-item[data-pid="+o+"]").length&&$("html, body").animate({scrollTop:$(".product-grid-item[data-pid="+o+"]").offset().top-125},1e3),$("img").lazyload({threshold:500,failure_limit:25})}else sessionStorage.removeItem("paginated_prods"),sessionStorage.removeItem("paginated_prods_URL"),sessionStorage.removeItem("paginated_prods_showmore");$(document).on("click","input[type=checkbox]",function(){console.log("chkbox clicked..."),$(this).prop("checked")?$(this).attr("checked",!0):$(this).attr("checked",!1)}),$(".clk-filter").on("click",function(){if(filter_menu_html=$(".filter-menu").html(),$("html, body").animate({scrollTop:0},500),$(this).hasClass("open-filter"))return $(this).removeClass("open-filter"),void $(".filter-overlay").trigger("click");if($(this).addClass("open-filter"),$(".filter-menu").addClass("is-active"),$(".facet-option").addClass("is-active"),$(".filter-overlay").addClass("is-active"),$("body").addClass("has-active-menu"),$(".facet-option").data("attr-facets")){var e=0;$(".filter-col").each(function(t,i){e+=$(i).width()}),$(".facet-option").width(e+50)}}),$(".filter-overlay").on("click",function(){$("html, body").animate({scrollTop:0},500),$(".facet-option").removeClass("is-active"),$(".filter-menu").removeClass("is-active"),$(".filter-overlay").removeClass("is-active"),$(".price-filter-block").removeClass("is-active"),$(".price-filter-block").animate({right:0},300),$("body").removeClass("has-active-menu"),$(".filter-menu").html(filter_menu_html)}),$(document).on("click",".cat-f-list-item",function(){if($(this).hasClass("p-filter-tags"))$(this).hasClass("selected-item")?($(this).removeClass("selected-item"),reLoadProducts(!1,!1,function(){},!0)):($(".cat-f-list-item").removeClass("selected-item"),$(this).addClass("selected-item"),reLoadProducts(!1,!1,function(){},!0));else{var e=$(this).find("span:last-of-type").text();$(this).hasClass("selected-item")?($(this).removeClass("selected-item"),$(".cat-sel-show.clk").click()):($(".cat-f-list-item").removeClass("selected-item"),$(this).addClass("selected-item"),$(".filter-show .cat-filter-click.clk").each(function(){$(this).text()==e&&$(this).click()})),$(".apply-button").click()}}),$(".filter-menu").on("click",".filter-show .cat-filter-click.clk",function(){$(".cat-sel-show").html($(this).text()).show(),$(".cat-head").hide();var e=getCookie("query"),t=JSON.parse(decodeURIComponent(e));t.l=1;var i=buildGetQForFacet(!0);$(".prange:checked").length?i.mrp=getSelectedPriceRanges():i.mrp=getAllPriceRanges(),i.facets="subcategory,is_hamper,is_personalizable,color",$.ajax({url:"/api/facets",method:"POST",dataType:"json",data:JSON.stringify({post:t,get:i}),contentType:"application/json; charset=UTF-8",async:!0,cache:!0,beforeSend:function(e){$(".subCat-head").css("text-align","center").html('<img src="/images/loading.gif" style="width: 20px;" align="center">').show()},success:function(e,t,i){if(e.status&&"Success"===e.status){num=e.data.num;var a="Select a Sub-Category",s=e.data.facets;for(var o in s)for(var n in s[o])if("mrp"==n&&updatePriceFiltersCount(s[o][n]),"subcategory"==n){var r=s[o][n];for(var l in r)a+='<div class="cat-show-filter subCat-filter-click clk">'+r[l].d+"</div>";$(".subCat-head").css("text-align","left").html(a).addClass("clk")}updateColorFilter(e.data.colors)}},complete:function(e,t){}})}),$(".filter-menu").on("click",".filter-show .subCat-filter-click.clk",function(){$(".subCat-sel-show").html($(this).text()).show(),$(".subCat-head").hide();var e=getCookie("query"),t=JSON.parse(decodeURIComponent(e));t.l=1;var i=buildGetQForFacet(!0);$(".prange:checked").length?i.mrp=getSelectedPriceRanges():i.mrp=getAllPriceRanges(),i.facets="product_type,is_hamper,is_personalizable,color";var a=$(".cat-sel-show").text(),s=$(this).text();i.category='"'+a+'"',i.subcategory='"'+s+'"',1!=$(".clk-filter").data("rro")&&(t.sc=s),console.log(JSON.stringify(i)),$.ajax({url:"/api/facets",method:"POST",dataType:"json",data:JSON.stringify({post:t,get:i}),contentType:"application/json; charset=UTF-8",async:!0,cache:!0,beforeSend:function(e){$(".prod-head").css("text-align","center").html('<img src="/images/loading.gif" style="width: 20px;" align="center">').show()},success:function(e,t,i){if(e.status&&"Success"===e.status){num=e.data.num;var a="Select a Product Type",s=e.data.facets;for(var o in s)for(var n in s[o])if("mrp"==n&&updatePriceFiltersCount(s[o][n]),"product_type"==n){var r=s[o][n];for(var l in r)a+='<div class="cat-show-filter prod-filter-click clk">'+r[l].d+"</div>";$(".prod-head").css("text-align","left").html(a)}updateColorFilter(e.data.colors)}},complete:function(e,t){}})});var n=!1;$(".del_types, .del-type-clk").click(function(){if(n){if($(".spl-del-content").hide(),$(".spl-del-popup").removeClass("is-active"),$("#d-mask").removeClass("is-active"),sdtApplied&&sdtModified){var e=sdtObj.delivery_types.split(",");$(".spl-d-t").prop("checked",!1),e.forEach(function(e,t){$("#"+e).prop("checked",!0)})}sdtApplied&&""!==sdtObj.pincode&&$("#pincode").val(sdtObj.pincode),sdtApplied&&""!==sdtObj.city&&$("#city").val(sdtObj.city),sdtApplied&&""!==sdtObj.country&&$("#country").val(sdtObj.country),n=!1}else $(".spl-del-content").show(),$(".spl-del-popup").addClass("is-active"),$("#d-mask").addClass("is-active"),n=!0}),$("#d-mask").click(function(){if($(".spl-del-content").hide(),$(".spl-del-popup").removeClass("is-active"),$("#d-mask").removeClass("is-active"),sdtApplied&&sdtModified){var e=sdtObj.delivery_types.split(",");$(".spl-d-t").prop("checked",!1),e.forEach(function(e,t){$("#"+e).prop("checked",!0)})}sdtApplied&&""!==sdtObj.pincode&&$("#pincode").val(sdtObj.pincode),sdtApplied&&""!==sdtObj.city&&$("#city").val(sdtObj.city),sdtApplied&&""!==sdtObj.country&&$("#country").val(sdtObj.country),n=!1}),$(".spl-del-wrapper").click(function(){$(".count-suggestion:visible .country-list").removeClass("open"),$(".cities-suggestion:visible .city-list").removeClass("open")}),$(".spl-del-wrapper").on("keyup","input#pincode",function(e){e.preventDefault(),$("input#country").val(""),$("#country").attr("disabled",!1),$(".edit-country-field").addClass("hidden"),$("input#city").val(""),$("#city").attr("disabled",!1),$(".edit-city-field").addClass("hidden"),$(".count-suggestion:visible .country-list").removeClass("open"),$(".cities-suggestion:visible .city-list").removeClass("open")}),$(".spl-del-wrapper").on("keyup","input#country",function(e){e.preventDefault(),$("input#pincode").val(""),$("#pincode").attr("disabled",!1),$(".edit-pin-field").addClass("hidden"),$("input#city").val(""),$("#city").attr("disabled",!1),$(".edit-city-field").addClass("hidden")}),$(".spl-del-wrapper").on("keyup","input#city",function(e){e.preventDefault(),$("input#pincode").val(""),$("#pincode").attr("disabled",!1),$(".edit-pin-field").addClass("hidden"),$("input#country").val(""),$("#country").attr("disabled",!1),$(".edit-country-field").addClass("hidden")})}),$(document).on("change",".spl-d-t",function(e){spdChangeHandler(e)}),$(document).on("click",".d-apply",function(e){return""===$("#pincode").val()||6===$("#pincode").val().length&&0!==parseInt($("#pincode").val())&&"777777"!==$("#pincode").val()&&"888888"!==$("#pincode").val()&&"999999"!==$("#pincode").val()?void(6===$("#pincode").val().length||0===$("#pincode").val().length?isNaN($("#pincode").val())?($("#pincode").addClass("error"),$("#pincode").addClass("error-animation"),setTimeout(function(){$("#pincode").removeClass("error-animation")},300)):($("#pincode").removeClass("error error-animation"),sdtObj.delivery_types="",$(".spl-d-t:checked").each(function(){sdtObj.delivery_types+=","+$(this).attr("id")}),sdtObj.delivery_types&&(sdtObj.delivery_types=sdtObj.delivery_types.substring(1)),
""!==$("#pincode").val()?sdtObj.pincode=$("#pincode").val():delete sdtObj.pincode,""!==$("#city").val()?sdtObj.city=$("#city").val():delete sdtObj.city,""!==$("#country").val()?sdtObj.country=$("#country").val():delete sdtObj.country,sdtApplied=!0,sdtModified=!1,reLoadProducts(!1,!1,function(){var e="";if(sdtObj.delivery_types){var t=sdtObj.delivery_types.split(","),i=["sdd","spd","mnd"];for(var a in t)switch(t[a]){case"sdd":$("#sdd-item").length<1&&(e+='<li class="spl-del-tag-item relative sdt-item" id="sdd-item">Sameday<i class="remove-filter sdt-cross" data-type="sdd"></i></li>');break;case"spd":$("#spd-item").length<1&&(e+='<li class="spl-del-tag-item relative sdt-item" id="spd-item">Fixed Time<i class="remove-filter sdt-cross" data-type="spd"></i></li>');break;case"mnd":$("#mnd-item").length<1&&(e+='<li class="spl-del-tag-item relative sdt-item" id="mnd-item">Midnight<i class="remove-filter sdt-cross" data-type="mnd"></i></li>')}for(var a in i)t.indexOf(i[a])<0&&($("#"+i[a]+"-item").remove(),console.log(i[a]))}sdtObj.pincode&&0!=sdtObj.pincode?(e+=' <span class="text-grey" id="pin-item"><span class="primary-color-text">:</span> '+sdtObj.pincode+"</span>",e+='<form class="tag-form hidden" id="tag-form">',e+='<input type="text" class="tag-input-field inline-pincode" id="inline-pincode" maxlength="6" value="'+sdtObj.pincode+'"/>',e+="</form>",$("#pincode-text").text(sdtObj.pincode),$(".edit-pin-field").removeClass("hidden"),$("#pincode").attr("disabled",!0),$("#pincode-text-line").removeClass("hidden"),$(".pincode-sel-text").html('<p class="pincode-sel-text">Showing products deliverable to <span id="pincode-sel-val" class="u-case color-red">'+sdtObj.pincode+'</span> only. <i class="remove-filter sdt-cross cross-icon-align" data-type="pin"></i></p>')):($("#pin-item").remove(),$("#pincode-text-line").addClass("hidden")),sdtObj.city&&""!==sdtObj.city?(e+=' <span class="text-grey" id="city-item"><span class="primary-color-text">:</span> '+sdtObj.city+"</span>",e+='<form class="tag-form hidden" id="tag-form">',e+='<input type="text" class="tag-input-field inline-city" id="inline-city" value="'+sdtObj.city+'"/>',e+="</form>",$("#city-text").text(sdtObj.city),$(".edit-city-field").removeClass("hidden"),$("#city").attr("disabled",!0),$("#city-text-line").removeClass("hidden"),$(".city-sel-text").html('<p class="city-sel-text">Showing products deliverable to <span id="city-sel-val" class="u-case color-red">'+sdtObj.city+'</span> only. <i class="remove-filter sdt-cross cross-icon-align" data-type="city"></i></p>')):($("#city-item").remove(),$("#city-text-line").addClass("hidden")),sdtObj.country&&0!=sdtObj.country?(e+='<span class="text-grey" id="country-item"><span class="primary-color-text">:</span> '+sdtObj.country+"</span>",e+='<form class="tag-form hidden" id="tag-form">',e+='<input type="text" class="tag-input-field inline-country" id="inline-country" maxlength="6" value="'+sdtObj.country+'"/>',e+="</form>",$("#country-text").text(sdtObj.country),$(".edit-country-field").removeClass("hidden"),$("#country").attr("disabled",!0),$("#country-text-line").removeClass("hidden"),$(".country-sel-text").html('<p class="country-sel-text">Showing products deliverable to <span id="country-sel-val" class="u-case color-red">'+sdtObj.country+'</span> only. <i class="remove-filter sdt-cross cross-icon-align" data-type="country"></i></p>')):($("#country-item").remove(),$("#country-text-line").addClass("hidden")),$("#apply-filter-pin-city-country").html(e)}),$(".spl-del-content").hide(),$(".error-msg").addClass("hidden"),$(".reset").prop("disabled",!1),$(".reset").addClass("d-clear"),$("#d-mask").removeClass("is-active"),$(".spl-del-popup").removeClass("is-active")):($(".error-msg").removeClass("hidden"),$("#pincode").addClass("error error-animation"),setTimeout(function(){$("#pincode").removeClass("error-animation")},300))):($("#pincode").addClass("error"),$("#pincode").addClass("error-animation"),void setTimeout(function(){$("#pincode").removeClass("error-animation")},300))}),$(document).on("submit","#tag-form",function(e){e.preventDefault(),6===$("#inline-pincode").val().length||0===$("#inline-pincode").val().length?isNaN($("#inline-pincode").val())?($("#inline-pincode").addClass("error"),$("#inline-pincode").addClass("error-animation"),setTimeout(function(){$("#inline-pincode").removeClass("error-animation")},300)):($("#inline-pincode").removeClass("error error-animation"),sdtObj.delivery_types="",$(".spl-d-t:checked").each(function(){sdtObj.delivery_types+=","+$(this).attr("id")}),sdtObj.delivery_types&&(sdtObj.delivery_types=sdtObj.delivery_types.substring(1)),""!==$("#inline-pincode").val()?sdtObj.pincode=$("#inline-pincode").val():delete sdtObj.pincode,sdtApplied=!0,sdtModified=!1,reLoadProducts(!1,!1,function(){var e="";if(sdtObj.delivery_types){var t=sdtObj.delivery_types.split(","),i=["sdd","spd","mnd"];for(var a in t)switch(t[a]){case"sdd":$("#sdd-item").length<1&&(e+='<li class="spl-del-tag-item relative sdt-item" id="sdd-item">Sameday<i class="remove-filter sdt-cross" data-type="sdd"></i></li>');break;case"spd":$("#spd-item").length<1&&(e+='<li class="spl-del-tag-item relative sdt-item" id="spd-item">Fixed Time<i class="remove-filter sdt-cross" data-type="spd"></i></li>');break;case"mnd":$("#mnd-item").length<1&&(e+='<li class="spl-del-tag-item relative sdt-item" id="mnd-item">Midnight<i class="remove-filter sdt-cross" data-type="mnd"></i></li>')}for(var a in i)t.indexOf(i[a])<0&&($("#"+i[a]+"-item").remove(),console.log(i[a]))}0!=sdtObj.pincode?($("#pin-item").length<1&&(e+='<li class="spl-del-tag-item relative sdt-item" id="pin-item">'+sdtObj.pincode+'<i class="remove-filter sdt-cross" data-type="pin"></i></li>'),$("#pincode-text").text(sdtObj.pincode),$(".edit-pin-field").removeClass("hidden"),$("#pincode").attr("disabled",!0),$("#pincode-text-line").removeClass("hidden"),$(".pincode-sel-text").html('<p class="u-case pincode-sel-text">Showing products deliverable to <span id="pincode-sel-val">'+sdtObj.pincode+'</span> only. <span class="change-get-pin" id="change-get-pin">Change</span></p>')):($("#pin-item").remove(),$("#pincode-text-line").addClass("hidden")),$(".spl-del-tag-list").append(e),$("#pincode").val(sdtObj.pincode),$("#tag-form").addClass("hidden"),$("#pincode-text").removeClass("hidden")}),$(".spl-del-content").hide(),$(".error-msg").addClass("hidden"),$(".reset").prop("disabled",!1),$(".reset").addClass("d-clear"),$("#d-mask").removeClass("is-active"),$(".spl-del-popup").removeClass("is-active")):($(".error-msg").removeClass("hidden"),$("#inline-pincode").addClass("error error-animation"),setTimeout(function(){$("#inline-pincode").removeClass("error-animation")},300))}),$(document).click(function(e){var t=$(e.target);$(document).on("blur","#inline-pincode",function(){t.is("#inline-pincode")||t.is("#pincode-text")||t.is("#pin-item .remove-filter")||t.is("#change-get-pin")||sdtObj.pincode&&(sdtObj.pincode===$(".inline-pincode").val()?makePinInlineUnEditable():$("#tag-form").submit())})}),$(document).on("change",".checkbox-del-india",function(){var e=$(this).data("filtertype");"pin"===e?($("#pin-check").prop("checked",!0),$("#city-check").attr("checked",!1),$(".pinFilter").removeClass("hidden"),$(".cityFilter").addClass("hidden")):($("#city-check").prop("checked",!0),$("#pin-check").attr("checked",!1),$(".pinFilter").addClass("hidden"),$(".cityFilter").removeClass("hidden"))}),$(document).on("click","#change-get-pin",function(){makePinInlineEditable()}),$(document).on("click",".remove-filter.sdt-cross",function(){var e=$(this).data("type");$(".strip-image")&&$(".strip-image").removeClass("spacer-top");var t="pin"===e||"country"===e||"city"===e;$("#"+e).attr("checked",!1),$("#"+e+"-item").remove(),sdtObj.delivery_types="",$(".spl-d-t:checked").each(function(){sdtObj.delivery_types+=","+$(this).attr("id")}),sdtObj.delivery_types=sdtObj.delivery_types.substring(1),"pin"==e&&(delete sdtObj.pincode,$("#pincode").val(""),$("#pincode").attr("disabled",!1),$(".edit-pin-field").addClass("hidden")),"city"==e&&(delete sdtObj.city,$("#city").val(""),$("#city").attr("disabled",!1),$(".edit-city-field").addClass("hidden")),"country"==e&&(delete sdtObj.country,$("#country").val(""),$("#country").attr("disabled",!1),$(".edit-country-field").addClass("hidden")),reLoadProducts(!1,!1,function(){"pin"==e&&$("#pincode-text-line").addClass("hidden"),"city"==e&&$("#city-text-line").addClass("hidden"),"country"==e&&$("#country-text-line").addClass("hidden"),11!=$(".selection-bar-w").data("type-two")&&29!=$(".selection-bar-w").data("type-two")||location.reload()},t)}),$(document).on("keypress",".inline-pincode",function(e){var t=e.keyCode||e.which;27==t&&($("#tag-form").addClass("hidden"),$("#pincode-text").removeClass("hidden"))}),$(document).on("click",".d-clear",function(e){$(".spl-d-t").prop("checked",!1),delete sdtObj.pincode,$("#pincode").val(""),$("#pincode").attr("disabled",!1),$(".edit-pin-field").addClass("hidden"),delete sdtObj.city,$("#city").val(""),$("#city").attr("disabled",!1),$(".edit-city-field").addClass("hidden"),delete sdtObj.country,$("#country").val(""),$("#country").attr("disabled",!1),$(".edit-country-field").addClass("hidden"),$(".reset").prop("disabled",!0),$("#d-mask").removeClass("is-active"),$(".spl-d-t").removeClass("disabled"),sdtObj={},reLoadProducts(!1,!1,function(){$(".sdt-item").remove()}),$(".spl-del-content").hide(),$(".spl-del-popup").removeClass("is-active"),$("#pincode-text-line").addClass("hidden"),$("#city-text-line").addClass("hidden"),$("#country-text-line").addClass("hidden"),$("#pin-item").remove(),$("#city-item").remove(),$("#country-item").remove()}),$(document).on("click",".edit-pin-field",function(){$(".edit-pin-field").addClass("hidden"),$("#pincode").attr("disabled",!1),$("#pincode").focus().select()}),$(document).on("click",".edit-city-field",function(){$(".edit-city-field").addClass("hidden"),$("#city").attr("disabled",!1),$("#city").focus().select()}),$(document).on("click",".edit-country-field",function(){$(".edit-country-field").addClass("hidden"),$("#country").attr("disabled",!1),$("#country").focus().select()}),$(document).on("click",".pincode-text",function(){makePinInlineEditable()}),$(".filter-menu").on("click",".price-filter-click",function(){if($(".price-filter-block").toggleClass("is-active"),$(".price-filter-block").hasClass("is-active")||$(".price-filter-block").animate({right:0}),$(".facet-option").hasClass("is-active")&&$(".facet-option").is(":visible")){var e=$(".facet-option").outerWidth();$(".price-filter-block").animate({right:e+"px"})}if($(".price-filter-block").hasClass("is-active")){var t=getCookie("query"),i=JSON.parse(decodeURIComponent(t));i.l=1;var a=buildGetQForFacet();a.facets=getFacetQuery(),a.mrp=getAllPriceRanges(),console.log(JSON.stringify(a)),$.ajax({url:"/api/facets",method:"POST",dataType:"json",data:JSON.stringify({post:i,get:a}),contentType:"application/json; charset=UTF-8",async:!0,cache:!0,beforeSend:function(e){},success:function(e,t,i){if(e.status&&"Success"===e.status){console.log(e.data);var a=e.data.facets;for(var s in a)for(var o in a[s])"mrp"==o&&updatePriceFiltersCount(a[s][o])}},complete:function(e,t){}})}}),$(".filter-menu").on("click",".mpl-price",function(){$(this).toggleClass("selected");var e=getCookie("query"),t=JSON.parse(decodeURIComponent(e));t.l=1;var i=buildGetQForFacet();i.mrp=getAllPriceRanges(),i.facets="all,is_hamper,is_personalizable,color",$.ajax({url:"/api/facets",method:"POST",dataType:"json",data:JSON.stringify({post:t,get:i}),contentType:"application/json; charset=UTF-8",async:!0,cache:!0,beforeSend:function(e){},success:function(e,t,i){if(e.status&&"Success"===e.status){console.log(e.data),num=e.data.num;var a=e.data.facets;for(var s in a)for(var o in a[s])"mrp"==o&&(updatePriceFiltersCount(a[s][o]),a.splice(s,1));var n=a.length,r=Math.ceil(n/2);updateFacetOptions(e,!1),console.log(num),e.data.facets.length>0?($(".facet-option").addClass("is-active"),$(".facet-option").show().animate({width:19.8*r+"em"},300)):$(".facet-option").removeClass("is-active"),updateColorFilter(e.data.colors),r&&$(".price-filter-block").animate({right:19.8*r+"em"},300)}},complete:function(e,t){$(".prod-filter-click img").remove()}})}),$(".filter-menu").on("change",".prange",function(){if($(this).attr("checked",!0)){var e=getCookie("query"),t=JSON.parse(decodeURIComponent(e));t.l=1;var i=buildGetQForFacet();$(".prange:checked").length?i.mrp=getSelectedPriceRanges():i.mrp=getAllPriceRanges(),i.facets="all,is_hamper,is_personalizable,color",$.ajax({url:"/api/facets",method:"POST",dataType:"json",data:JSON.stringify({post:t,get:i}),contentType:"application/json; charset=UTF-8",async:!0,cache:!0,beforeSend:function(e){},success:function(e,t,i){if(e.status&&"Success"===e.status){console.log(e.data),num=e.data.num;var a=e.data.facets;for(var s in a)for(var o in a[s])"mrp"==o&&a.splice(s,1);var n=a.length,r=Math.ceil(n/2);updateFacetOptions(e,!1),console.log(num),e.data.facets.length>0?($(".facet-option").addClass("is-active"),$(".facet-option").show().animate({width:19.8*r+"em"},300)):$(".facet-option").removeClass("is-active"),updateColorFilter(e.data.colors),r&&$(".price-filter-block").animate({right:19.8*r+"em"},300)}},complete:function(e,t){}})}}),$(".filter-menu").on("click",".prod-filter-click.clk",function(){var e=getCookie("query"),t=JSON.parse(decodeURIComponent(e));t.l=1,$(".prod-filter-click").removeClass("selected-gb"),$(".prod-filter-click img").remove(),$(this).append('<img class="loader" src="/images/loading.gif" >'),$(this).addClass("selected-gb");var i=buildGetQForFacet(!0);$(".prange:checked").length?i.mrp=getSelectedPriceRanges():i.mrp=getAllPriceRanges(),i.facets="all,is_hamper,is_personalizable,color";var a=$(".cat-sel-show").text(),s=$(".subCat-sel-show").text(),o=$(this).text();i.category='"'+a+'"',i.subcategory='"'+s+'"',i.product_type='"'+o+'"',1!=$(".clk-filter").data("rro")&&(t.pt=o,t.sc=s),$.ajax({url:"/api/facets",method:"POST",dataType:"json",data:JSON.stringify({post:t,get:i}),contentType:"application/json; charset=UTF-8",async:!0,cache:!0,beforeSend:function(e){$(".facet-option .applied-filters").html("NO FILTERS APPLIED"),$(".facet-option .filter-group").html('<img class="loader" src="/images/loading.gif" style="width: 20px;">')},success:function(e,t,i){if(e.status&&"Success"===e.status){console.log(e.data),num=e.data.num;var a=e.data.facets;if(!a)return $(".facet-option").hide(),$(".price-filter-block").animate({right:0},300),void $(".facet-option .filter-group").html("");for(var s in a)for(var o in a[s])"mrp"==o&&(updatePriceFiltersCount(a[s][o]),a.splice(s,1));var n=a?a.length:0,r=Math.ceil(n/2),l=generateFilterGroupHtml(a);$(".facet-option .filter-group").html(l),console.log(num),e.data.facets.length>0?($(".facet-option").addClass("is-active"),$(".facet-option").show().animate({width:19.8*r+"em"},300)):$(".facet-option").removeClass("is-active"),updateColorFilter(e.data.colors),r&&$(".price-filter-block").animate({right:19.8*r+"em"},300)}},complete:function(e,t){$(".prod-filter-click img").remove()}})}),$(".filter-menu").on("click",".cat-sel-show.clk",function(){$(".cat-sel-show").hide().html(""),$(".subCat-sel-show").hide().html(""),$(".subCat-head").hide().html(""),$(".prod-head").hide().html(""),$(".facet-option").hide(),$(".price-filter-block").animate({right:0},300),$(".facet-option .filter-group").html("");var e=getCookie("query"),t=JSON.parse(decodeURIComponent(e));t.l=1;var i=buildGetQForFacet(!0);delete i.category,setCookie("getQ",JSON.stringify(i)),i.facets="category,is_hamper,is_personalizable,color",$.ajax({url:"/api/facets",method:"POST",dataType:"json",data:JSON.stringify({post:t,get:i}),contentType:"application/json; charset=UTF-8",async:!0,cache:!0,beforeSend:function(e){$('<img src="/images/loading.gif" style="width: 20px;" class="cat-loader" align="center">').insertBefore(".cat-head")},success:function(e,t,i){if(e.status&&"Success"===e.status){var a={},s=e.data.facets;if(0===$(".cat-show-filter.cat-filter-click").length){var o,n="";for(var r in s)"category"===Object.keys(s[r])[0]&&(o=r);if(0===$(".cat-head.common-head").length){if(n+='<div class="cat-head common-head">Select Category',s.length>0)for(var l in s[o].category)n+='<div class="cat-show-filter cat-filter-click clk">'+s[o].category[l].d+"</div>";n+="</div>",$(".filter-show").append(n)}else{if(n+="Select Category",s.length>0)for(var l in s[o].category)n+='<div class="cat-show-filter cat-filter-click clk">'+s[o].category[l].d+"</div>";$(".cat-head.common-head").append(n)}}for(var l in s)for(var c in s[l])"mrp"==c&&updatePriceFiltersCount(s[l][c]),"category"==c&&(s[l][c].forEach(function(e,t){a[e.d]=e.n}),$(".cat-show-filter.cat-filter-click").each(function(e,t){a[$(t).text()]?$(t).addClass("clk"):$(t).removeClass("clk")}),$(".cat-head").prev(".cat-loader").remove(),$(".cat-head").show());updateColorFilter(e.data.colors)}},complete:function(e,t){}})}),$(".filter-menu").on("click",".subCat-sel-show.clk",function(){$(".subCat-sel-show").hide().html(""),$(".prod-head").hide().html(""),$(".facet-option").hide(),$(".price-filter-block").animate({right:0},300),$(".facet-option .filter-group").html("");var e=getCookie("query"),t=JSON.parse(decodeURIComponent(e));t.l=1;var i=buildGetQForFacet(!0);$(".prange:checked").length?i.mrp=getSelectedPriceRanges():i.mrp=getAllPriceRanges(),i.facets="subcategory,is_hamper,is_personalizable,color",$.ajax({url:"/api/facets",method:"POST",dataType:"json",data:JSON.stringify({post:t,get:i}),contentType:"application/json; charset=UTF-8",async:!0,cache:!0,beforeSend:function(e){$('<img src="/images/loading.gif" style="width: 20px;" class="subcat-loader" align="center">').insertBefore(".subCat-head")},success:function(e,t,i){if(e.status&&"Success"===e.status){var a=e.data.facets;if(0===$(".cat-show-filter.subCat-filter-click").length){var s,o="";for(var n in a)"subcategory"===Object.keys(a[n])[0]&&(s=n);if(0===$(".subCat-head.common-head").length){if(o+='<div class="subCat-head common-head">Select Subcategory',a.length>0)for(var r in a[s].subcategory)o+='<div class="cat-show-filter subCat-filter-click clk">'+a[s].subcategory[r].d+"</div>";o+="</div>",$(".filter-show").append(o)}else{if(o+="Select Subcategory",a.length>0)for(var r in a[s].subcategory)o+='<div class="cat-show-filter subCat-filter-click clk">'+a[s].subcategory[r].d+"</div>";$(".subCat-head.common-head").append(o)}}var l={};for(var r in a)for(var c in a[r])"mrp"==c&&updatePriceFiltersCount(a[r][c]),"subcategory"==c&&(a[r][c].forEach(function(e,t){l[e.d]=e.n}),$(".cat-show-filter.subCat-filter-click").each(function(e,t){l[$(t).text()]?$(t).addClass("clk"):$(t).removeClass("clk")}),$(".subCat-head").prev(".subcat-loader").remove(),$(".subCat-head").show());updateColorFilter(e.data.colors)}},complete:function(e,t){}})}),$(".filter-menu").on("change",".filter-group .prop_check",function(){var e=$(this);$(".prop_check").attr("disabled",!0);var t="";t+=$(".prop_check:checked").length?'Applied Filters <div class="selected-props">':"NO FILTERS APPLIED",$(".prop_check:checked").each(function(){t+='<span class="selected-property" data-id="'+$(this).attr("id")+'">'+$(this).data("value")+' <i class="remove-filter"></i></span>'}),$(".prop_check:checked").length&&(t+="</div>"),$(".applied-filters").html(t);var i=getCookie("query"),a=JSON.parse(decodeURIComponent(i));a.l=1;var s=buildGetQForFacet();s.facets="all,is_hamper,is_personalizable,color",s.mrp=getAllPriceRanges(),$.ajax({url:"/api/facets",method:"POST",dataType:"json",data:JSON.stringify({post:a,get:s}),contentType:"application/json; charset=UTF-8",async:!0,cache:!0,beforeSend:function(t){e.closest(".filter-div").addClass("clicked-block")},success:function(e,t,i){if(e.status&&"Success"===e.status){num=e.data.num;var a=e.data.facets,s={};for(var o in a)for(var n in a[o])"mrp"==n&&(updatePriceFiltersCount(a[o][n]),a.splice(o,1));for(var o in a){var r=a[o];for(var l in r){var c=r[l];for(var d in c)s[c[d].d]=c[d].n}}$(".filter-div:not(.clicked-block) .prop_check").each(function(){var e=$(this).data("value");s.hasOwnProperty(e)?($(this).attr("disabled",!1),$(this).parent().find("span").html(s[e])):$(this).parent().find("span").html("0")}),$(".filter-div.clicked-block .prop_check").each(function(){"0"!==$(this).parent().find("span").html()&&$(this).attr("disabled",!1)}),updateFacetOptions(e,!1),console.log("attr set clicked"),updateColorFilter(e.data.colors)}},complete:function(t,i){e.closest(".filter-div").removeClass("clicked-block")}})}),$(".filter-menu").on("click",".applied-filters .selected-property",function(){var e=$(this).data("id");$("#"+e).trigger("click")}),$(".filter-menu").on("click",".apply-button",function(){filter_menu_html=$(".filter-menu").html(),$(".clk-filter").removeClass("open-filter"),$(".facet-option").removeClass("is-active"),$(".filter-menu").removeClass("is-active"),$(".filter-overlay").removeClass("is-active"),$("body").removeClass("has-active-menu"),$(".price-filter-block").removeClass("is-active"),$(".price-filter-block").animate({right:0},300),reLoadProducts(!1,!1,function(){})}),$(".filter-menu").on("click",".reset-button",function(){$(".clk-filter").removeClass("open-filter"),$(".cat-sel-show.clk").hide().html(""),$(".subCat-sel-show.clk").hide().html(""),$(".cat-head").show(),$(".subCat-head.clk").hide().html(""),$(".subCat-head:not(.clk)").show(),$(".prod-head.clk").hide().html(""),$(".prod-filter-click").length>1&&$(".prod-filter-click").removeClass("selected-gb"),$(".facet-option.clk").hide(),$(".facet-option.clk .filter-group").html(""),$(".prop_check").prop("checked",!1),$(".prange").prop("checked",!1),$(".color-prop").removeClass("selected"),$(".applied-filters").html("NO FILTERS APPLIED"),$(".facet-option").removeClass("is-active"),$(".filter-menu").removeClass("is-active"),$(".filter-overlay").removeClass("is-active"),$("body").removeClass("has-active-menu"),$(".price-filter-block").removeClass("is-active"),$(".price-filter-block").animate({right:0},300),$(".mpl-price").removeClass("selected"),reLoadProducts(!0,!1,function(){}),$(".filter-text").removeClass("filter-enabled")}),$(".sort ul.c-dd-options li").on("click",function(){$(".sort ul.c-dd-options li").removeClass("selected"),$(this).addClass("selected"),reLoadProducts(!1,!1,function(){})}),$(".checkbox-hp").on("change",function(){num=$(this).data("count"),reLoadProducts(!1,!0,function(){})}),$(".filter-menu").on("click",".colors .color-prop:not(.disabled):not(.waiting)",function(){$(this).toggleClass("selected"),$(".colors .color-prop").addClass("waiting");var e=getCookie("query"),t=JSON.parse(decodeURIComponent(e));t.l=1;var i=buildGetQForFacet();i.facets=getFacetQuery(),$.ajax({url:"/api/facets",method:"POST",dataType:"json",data:JSON.stringify({post:t,get:i}),contentType:"application/json; charset=UTF-8",async:!0,cache:!0,beforeSend:function(e){},success:function(e,t,i){if(e.status&&"Success"===e.status){if(num=e.data.num,$(".colors .color-prop").removeClass("waiting"),update_hp(e),""===$(".cat-sel-show").text()){var a={};e.data.facets[0].category.forEach(function(e,t){a[e.d]=e.n}),$(".cat-show-filter.cat-filter-click").each(function(e,t){a[$(t).text()]?$(t).addClass("clk"):$(t).removeClass("clk")})}if(""!==$(".cat-sel-show").text()&&""===$(".subCat-sel-show").text()){var s={};e.data.facets[0].subcategory.forEach(function(e,t){s[e.d]=e.n}),$(".cat-show-filter.subCat-filter-click").each(function(e,t){s[$(t).text()]?$(t).addClass("clk"):$(t).removeClass("clk")})}if(""!==$(".cat-sel-show").text()&&""!==$(".subCat-sel-show").text()&&""===$(".prod-filter-click.selected-gb").text()){var o={};e.data.facets[0].product_type.forEach(function(e,t){o[e.d]=e.n}),$(".cat-show-filter.prod-filter-click").each(function(e,t){o[$(t).text()]?$(t).addClass("clk"):$(t).removeClass("clk")})}if(""!==$(".cat-sel-show").text()&&""!==$(".subCat-sel-show").text()&&""!==$(".prod-filter-click.selected-gb").text()){var n=e.data.facets,r={};for(var l in n){var c=n[l];for(var d in c){var p=c[d];for(var u in p)r[p[u].d]=p[u].n}}$(".filter-div .prop_check").each(function(){var e=$(this).data("value");r.hasOwnProperty(e)?($(this).attr("disabled",!1),$(this).parent().find("span").html(r[e])):($(this).attr("disabled",!0),$(this).parent().find("span").html("0"))})}}}})});;
function updateRROP(){console.log("updating RROP");var e={};$(".s-button.selected").each(function(){e[$(this).attr("data-selected-type")]=$(this).attr("data-val")}),$(".s-button.selectable").each(function(){var t=$(this).attr("data-val");t&&(t=t.split("|")[1]),e[$(this).attr("data-selected-type")]=t?t:""}),console.log(e);var t=0;for(var i in e)""===e[i]&&(t+=1);(t>0||t!==$(".s-button.selectable").length)&&$.ajax({url:"/api/rrop",method:"POST",dataType:"json",data:JSON.stringify(e),contentType:"application/json; charset=UTF-8",async:!0,cache:!0,beforeSend:function(e){},success:function(e,t,i){for(var a in e){var s="";e[a].forEach(function(e,t){console.log(JSON.stringify(e)),s+='<li rel="'+e.code+"|"+e.qcode+'" class="s-item-list-filter selectable" data-val="'+e.code+'" data-label="'+e.label+'" data-change="true">',s+='<div class="icon-wrapper rec-i-wrapper" >',s+='<svg viewBox="0 0 2 2" class="s-icon ">',s+='<use xlink:href="svgs/rrop/svg-rrop.svg#shape-'+e.qcode+'"></use>',s+="</svg></div>",s+='<p class="text-center">'+e.label+"</p>",s+="</li>"}),$("#"+a+"-items .s-item-list").html(s)}},complete:function(e,t){}})}$(".bg-red select.changeable").on("change",function(){var e=$(this).val();""!=e&&(document.location.href="/"+$(this).val())}),$(".notred select.changeable").on("change",function(){reLoadProducts(!1,!1,function(){});var e=$(this).data("change");e&&updateRROP()}),$("#site-wrapper").on("click",".s-item-list-filter",function(){var e=$(this).parents(".refine-list-item").find(".s-button").text(),t=$(this).data("label"),i=$(this).attr("rel");if(e!==t){$(this).parents(".refine-list-item").find(".s-button").text(t),$(this).parents(".refine-list-item").find(".s-button").attr("data-val",i),console.log("trying to reload the products."),reLoadProducts(!1,!1,function(){});var a=$(this).data("change");a&&updateRROP()}});;